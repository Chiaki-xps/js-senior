# 1. JS中函数是一等公民

+ 在JavaScript中，函数是非常重要的，并且是一等公民：
  + 那么就意味着函数的使用是非常灵活的；
  + 函数可以作为另一个函数的参数，也可以作为另一个函数的返回值来使用；
  + js语法允许函数内定义函数，像C就不允许
+ 可以编写高阶函数：把一个函数作为另一个函数的参数，或者函数返回另一个函数作为返回值的函数。
+ 使用内置高阶函数。

# 2. JS中闭包的定义

+ 闭包在其它计算机语言中也是存在的，分成两个：在计算机科学中和在JavaScript中

+ 计算机科学中对闭包的定义：
  + 闭包（Closure），又称词法闭包（Lexical Closure）或函数闭包（function closures）；
    + 词法闭包意味着我们在词法分析的时候就被确定了。
    + 词法分析就是我们的代码进入浏览器后词法分析之后生成一个个键值对然后转换成AST树。
  + 是在支持**头等函数**的编程语言中，实现词法绑定的一种技术；
    + 头等函数意味着函数时第一公民。
  + 闭包是在实现上是一个结构体，它存储了一个函数和一个关联的环境（相当于一个富豪查找表）；
    + 结构体在JS中是一个对象，保存着一个函数和关联环境。
  + 闭包跟函数最大的区别在于，当捕捉闭包的时候，他的**自由变量**会在捕捉时被确定，这样即使脱离了捕捉时的上下文它也能照常运行。

+ MDN对JavaScript闭包的解释：
  + 一个函数和对其周围状态（lexical environment，词法环境）的引用捆绑在一起（或者说函数被引用包围），这样的组合就是闭包（closure）；
  + 也就是说，闭包让你可以在一个内层函数中访问到其外层函数的作用域
  + 在JavaScript中，每当创建一个函数，闭包就会在函数创建的同时被创建出来。（说明创建函数的同时闭包也被创建了）

+ 总结：
  + 一个普通的函数function，



```js
function foo() {
    function bar() {
        console.log('bar')
    }
    
    return bar
}

var fn = foo()
fn()
```

+ 代码开始前会现有调用栈和堆内存，并且堆内存会先创建好`GO`
+ 函数的函数体会保存到函数对象地址里面，把地址给到`GO`

+ 函数开始执行前会先创建AO对象，`AO`保存函数体里定义的内容，之后执行函数的时候开始赋值
+ 执行`var fn = foo()`后，`foo`函数执行上下文销毁，它的`AO`也没有其它执行它也跟着销毁。而`fn`保存`bar`函数对象地址。
+ `fn()`执行过程的中会创建函数执行上下文，然后执行完成，销毁。

```js
function foo() {
    var name = 'foo'
    function bar() {
        console.log("bar", name)
    }.
    return bar
}

var fn = foo()
fn()
```

















